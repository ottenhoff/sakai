<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:sakai="http://sakaiproject.org/jsf2/sakai">

    <f:view>
        <h:head>
            <ui:fragment rendered="#{not empty requestScope['html.head']}">
                <h:outputText value="#{requestScope['html.head']}" escape="false" />
            </ui:fragment>
            <title>
                <h:outputText value="#{evaluationMessages.sub_status}" />
            </title>
            <script src="/samigo-app/js/delivery.js"></script>
            <h:outputScript target="body">
//<![CDATA[
document.addEventListener('DOMContentLoaded', function () {
    const currentLink = document.getElementById('editTotalResults:submissionStatusMenuLink');
    if (!currentLink) {
        return;
    }
    currentLink.classList.add('current');
    const anchor = currentLink.querySelector('a');
    if (anchor) {
        currentLink.textContent = anchor.textContent;
    }
});
//]]>
            </h:outputScript>
        </h:head>
        <h:body onload="#{empty requestScope['html.body.onload'] ? '' : requestScope['html.body.onload']}">
            <div class="portletBody container-fluid">
                <h:form id="editTotalResults">
                    <h:inputHidden id="publishedId" value="#{totalScores.publishedId}" />
                    <h:inputHidden id="itemId" value="#{totalScores.firstItem}" />

                    <ui:include src="/jsf/evaluation/evaluationHeadings.xhtml" />

                    <div class="page-header">
                        <h1>
                            <h:outputText value="#{evaluationMessages.sub_status}#{evaluationMessages.column} "
                                escape="false" />
                            <small>
                                <h:outputText value="#{totalScores.assessmentName} " escape="false" />
                            </small>
                        </h1>
                    </div>

                    <ui:include src="/jsf/evaluation/evaluationSubmenu.xhtml" />

                    <h:messages styleClass="sak-banner-error"
                        rendered="#{! empty facesContext.maximumSeverity}" layout="table" />

                    <sakai:flowState bean="#{submissionStatus}" />

                    <h:panelGroup rendered="#{!totalScores.hasRandomDrawPart}" layout="block">
                        <h2>
                            <h:outputText value="#{evaluationMessages.max_score_poss}" />
                            <small>
                                <h:outputText value=": #{totalScores.maxScore}" />
                            </small>
                        </h2>
                    </h:panelGroup>

                    <h:panelGroup styleClass="row" layout="block">
                        <h:panelGroup styleClass="col-md-6" layout="block">
                            <div class="form-group row">
                                <h:outputLabel styleClass="col-md-2" value="#{evaluationMessages.view}"
                                    rendered="#{totalScores.availableSectionSize gt 0}" />
                                <h:outputLabel styleClass="col-md-2"
                                    value="#{evaluationMessages.view}&#160;#{evaluationMessages.all_sections}"
                                    escape="false" rendered="#{totalScores.availableSectionSize lt 1}" />
                                <div class="col-md-10">
                                    <h:selectOneMenu value="#{submissionStatus.selectedSectionFilterValue}"
                                        id="sectionpicker" required="true" onchange="document.forms[0].submit();"
                                        rendered="#{totalScores.availableSectionSize ge 1}">
                                        <f:selectItems value="#{totalScores.sectionFilterSelectItems}" />
                                        <f:valueChangeListener
                                            type="org.sakaiproject.tool.assessment.ui.listener.evaluation.SubmissionStatusListener" />
                                    </h:selectOneMenu>
                                </div>
                            </div>

                            <h:panelGroup styleClass="form-group row search-box" layout="block">
                                <h:outputLabel styleClass="col-md-2" value="#{evaluationMessages.search}" />
                                <div class="col-md-10">
                                    <h:inputText id="searchString" value="#{submissionStatus.searchString}"
                                        onfocus="clearIfDefaultString(this, '#{evaluationMessages.search_default_student_search_string}')"
                                        onkeypress="return submitOnEnter(event, 'editTotalResults:searchSubmitButton');" />
                                    <h:outputText value="&#160;" escape="false" />
                                    <h:commandButton actionListener="#{submissionStatus.search}"
                                        value="#{evaluationMessages.search_find}" id="searchSubmitButton" />
                                    <h:outputText value="&#160;" escape="false" />
                                    <h:commandButton actionListener="#{submissionStatus.clear}"
                                        value="#{evaluationMessages.search_clear}" />
                                </div>
                            </h:panelGroup>
                        </h:panelGroup>
                        <div class="pager-holder col-md-6" style="text-align: right">
                            <sakai:pager id="pager" totalItems="#{submissionStatus.dataRows}"
                                firstItem="#{submissionStatus.firstRow}"
                                pageSize="#{submissionStatus.maxDisplayedRows}"
                                textStatus="#{evaluationMessages.paging_status}" />
                        </div>
                    </h:panelGroup>

                    <div class="table-responsive">
                        <h:dataTable value="#{submissionStatus.agents}" var="description"
                            styleClass="table table-striped table-bordered"
                            rendered="#{submissionStatus.dataRows gt 0}">

                            <h:column rendered="#{submissionStatus.sortType ne 'lastName'}">
                                <f:facet name="header">
                                    <h:commandLink title="#{evaluationMessages.t_sortLastName}" id="lastName"
                                        action="submissionStatus" immediate="true">
                                        <h:outputText value="#{evaluationMessages.name}" />
                                        <f:actionListener
                                            type="org.sakaiproject.tool.assessment.ui.listener.evaluation.SubmissionStatusListener" />
                                        <f:param name="sortBy" value="lastName" />
                                        <f:param name="sortAscending" value="true" />
                                    </h:commandLink>
                                </f:facet>
                                <sakai-user-photo user-id="#{description.idString}"
                                    profile-popup="on" />
                                <h:panelGroup>
                                    <a name="#{description.lastInitial}"></a>
                                    <h:outputText value="#{description.lastName}" />
                                    <h:outputText value=", "
                                        rendered="#{description.lastInitial ne 'Anonymous'}" />
                                    <h:outputText value="#{description.firstName}" />
                                    <h:outputText value="#{evaluationMessages.na}"
                                        rendered="#{description.lastInitial eq 'Anonymous'}" />
                                    <br />
                                    <h:panelGroup styleClass="itemAction"
                                        rendered="#{totalScores.anonymous eq 'false' and description.email != null and description.email != ''}">
                                        <a href="mailto:#{description.email}?subject=#{totalScores.assessmentName} #{commonMessages.feedback}">
                                            <h:outputText value="  #{evaluationMessages.email}" escape="false" />
                                        </a>
                                    </h:panelGroup>
                                </h:panelGroup>
                                <h:outputText value=" #{evaluationMessages.separator} "
                                    rendered="#{totalScores.anonymous eq 'false' and description.email != null and description.email != '' and description.retakeAllowed}" />
                                <span class="itemAction">
                                    <h:commandLink title="#{evaluationMessages.t_retake}"
                                        id="retakeAssessment1" immediate="true"
                                        rendered="#{description.retakeAllowed}" action="confirmRetake">
                                        <h:outputText value="#{evaluationMessages.allow_retake}" />
                                        <f:param name="agentIdString" value="#{description.idString}" />
                                        <f:param name="publishedAssessmentId" value="#{totalScores.publishedId}" />
                                        <f:actionListener
                                            type="org.sakaiproject.tool.assessment.ui.listener.evaluation.ConfirmRetakeAssessmentListener" />
                                    </h:commandLink>
                                </span>
                            </h:column>

                            <h:column
                                rendered="#{submissionStatus.sortType eq 'lastName' and submissionStatus.sortAscending}">
                                <f:facet name="header">
                                    <h:commandLink title="#{evaluationMessages.t_sortLastName}"
                                        action="submissionStatus">
                                        <h:outputText value="#{evaluationMessages.name}" />
                                        <f:param name="sortAscending" value="false" />
                                        <h:graphicImage alt="#{evaluationMessages.alt_sortLastNameDescending}"
                                            rendered="#{submissionStatus.sortAscending}"
                                            url="/images/sortascending.gif" />
                                        <f:actionListener
                                            type="org.sakaiproject.tool.assessment.ui.listener.evaluation.SubmissionStatusListener" />
                                        <f:param name="sortBy" value="lastName" />
                                    </h:commandLink>
                                </f:facet>
                                <sakai-user-photo user-id="#{description.idString}"
                                    profile-popup="on" />
                                <h:panelGroup>
                                    <a name="#{description.lastInitial}"></a>
                                    <h:outputText value="#{description.lastName}" />
                                    <h:outputText value=", "
                                        rendered="#{description.lastInitial ne 'Anonymous'}" />
                                    <h:outputText value="#{description.firstName}" />
                                    <h:outputText value="#{evaluationMessages.na}"
                                        rendered="#{description.lastInitial eq 'Anonymous'}" />
                                    <br />
                                    <span class="itemAction">
                                        <h:panelGroup
                                            rendered="#{totalScores.anonymous eq 'false' and description.email != null and description.email != ''}">
                                            <a href="mailto:#{description.email}?subject=#{totalScores.assessmentName} #{commonMessages.feedback}">
                                                <h:outputText value="  #{evaluationMessages.email}" escape="false" />
                                            </a>
                                        </h:panelGroup>
                                    </span>
                                </h:panelGroup>
                                <h:outputText value=" #{evaluationMessages.separator} "
                                    rendered="#{totalScores.anonymous eq 'false' and description.email != null and description.email != '' and description.retakeAllowed}" />
                                <span class="itemAction">
                                    <h:commandLink title="#{evaluationMessages.t_retake}"
                                        id="retakeAssessment2" immediate="true"
                                        rendered="#{description.retakeAllowed}" action="confirmRetake">
                                        <h:outputText value="#{evaluationMessages.allow_retake}" />
                                        <f:param name="agentIdString" value="#{description.idString}" />
                                        <f:param name="publishedAssessmentId" value="#{totalScores.publishedId}" />
                                        <f:actionListener
                                            type="org.sakaiproject.tool.assessment.ui.listener.evaluation.ConfirmRetakeAssessmentListener" />
                                    </h:commandLink>
                                </span>
                            </h:column>

                            <h:column
                                rendered="#{submissionStatus.sortType eq 'lastName' and !submissionStatus.sortAscending}">
                                <f:facet name="header">
                                    <h:commandLink title="#{evaluationMessages.t_sortLastName}"
                                        action="submissionStatus">
                                        <h:outputText value="#{evaluationMessages.name}" />
                                        <f:param name="sortAscending" value="true" />
                                        <h:graphicImage alt="#{evaluationMessages.alt_sortLastNameAscending}"
                                            rendered="#{!submissionStatus.sortAscending}"
                                            url="/images/sortdescending.gif" />
                                        <f:actionListener
                                            type="org.sakaiproject.tool.assessment.ui.listener.evaluation.SubmissionStatusListener" />
                                        <f:param name="sortBy" value="lastName" />
                                    </h:commandLink>
                                </f:facet>
                                <sakai-user-photo user-id="#{description.idString}"
                                    profile-popup="on" />
                                <h:panelGroup>
                                    <a name="#{description.lastInitial}"></a>
                                    <h:outputText value="#{description.lastName}" />
                                    <h:outputText value=", "
                                        rendered="#{description.lastInitial ne 'Anonymous'}" />
                                    <h:outputText value="#{description.firstName}" />
                                    <h:outputText value="#{evaluationMessages.na}"
                                        rendered="#{description.lastInitial eq 'Anonymous'}" />
                                    <br />
                                    <h:panelGroup styleClass="itemAction"
                                        rendered="#{totalScores.anonymous eq 'false' and description.email != null and description.email != ''}">
                                        <a href="mailto:#{description.email}?subject=#{totalScores.assessmentName} #{commonMessages.feedback}"><h:outputText value="  #{evaluationMessages.email}" escape="false" /></a>
                                    </h:panelGroup>
                                </h:panelGroup>
                                <h:outputText value=" #{evaluationMessages.separator} "
                                    rendered="#{totalScores.anonymous eq 'false' and description.email != null and description.email != '' and description.retakeAllowed}" />
                                <span class="itemAction">
                                    <h:commandLink title="#{evaluationMessages.t_retake}"
                                        id="retakeAssessment3" immediate="true"
                                        rendered="#{description.retakeAllowed}" action="confirmRetake">
                                        <h:outputText value="#{evaluationMessages.allow_retake}" />
                                        <f:param name="agentIdString" value="#{description.idString}" />
                                        <f:param name="publishedAssessmentId" value="#{totalScores.publishedId}" />
                                        <f:actionListener
                                            type="org.sakaiproject.tool.assessment.ui.listener.evaluation.ConfirmRetakeAssessmentListener" />
                                    </h:commandLink>
                                </span>
                            </h:column>

                            <h:column rendered="#{submissionStatus.sortType ne 'agentDisplayId'}">
                                <f:facet name="header">
                                    <h:commandLink title="#{evaluationMessages.t_sortUserId}" id="agentDisplayId"
                                        action="submissionStatus">
                                        <h:outputText value="#{evaluationMessages.uid}" />
                                        <f:actionListener
                                            type="org.sakaiproject.tool.assessment.ui.listener.evaluation.SubmissionStatusListener" />
                                        <f:param name="sortBy" value="agentDisplayId" />
                                        <f:param name="sortAscending" value="true" />
                                    </h:commandLink>
                                </f:facet>
                                <h:outputText value="#{description.agentDisplayId}" />
                            </h:column>

                            <h:column
                                rendered="#{submissionStatus.sortType eq 'agentDisplayId' and submissionStatus.sortAscending}">
                                <f:facet name="header">
                                    <h:commandLink title="#{evaluationMessages.t_sortUserId}"
                                        action="submissionStatus">
                                        <h:outputText value="#{evaluationMessages.uid}" />
                                        <f:param name="sortAscending" value="false" />
                                        <h:graphicImage alt="#{evaluationMessages.alt_sortUserIdDescending}"
                                            rendered="#{submissionStatus.sortAscending}"
                                            url="/images/sortascending.gif" />
                                        <f:actionListener
                                            type="org.sakaiproject.tool.assessment.ui.listener.evaluation.SubmissionStatusListener" />
                                    </h:commandLink>
                                </f:facet>
                                <h:outputText value="#{description.agentDisplayId}" />
                            </h:column>

                            <h:column
                                rendered="#{submissionStatus.sortType eq 'agentDisplayId' and !submissionStatus.sortAscending}">
                                <f:facet name="header">
                                    <h:commandLink title="#{evaluationMessages.t_sortUserId}"
                                        action="submissionStatus">
                                        <h:outputText value="#{evaluationMessages.uid}" />
                                        <f:param name="sortAscending" value="true" />
                                        <h:graphicImage alt="#{evaluationMessages.alt_sortUserIdAscending}"
                                            rendered="#{!submissionStatus.sortAscending}"
                                            url="/images/sortdescending.gif" />
                                        <f:actionListener
                                            type="org.sakaiproject.tool.assessment.ui.listener.evaluation.SubmissionStatusListener" />
                                    </h:commandLink>
                                </f:facet>
                                <h:outputText value="#{description.agentDisplayId}" />
                            </h:column>

                            <h:column rendered="#{submissionStatus.sortType ne 'role'}">
                                <f:facet name="header">
                                    <h:commandLink title="#{evaluationMessages.t_sortRole}" id="role"
                                        action="submissionStatus">
                                        <h:outputText value="#{evaluationMessages.role}" />
                                        <f:actionListener
                                            type="org.sakaiproject.tool.assessment.ui.listener.evaluation.SubmissionStatusListener" />
                                        <f:param name="sortBy" value="role" />
                                        <f:param name="sortAscending" value="true" />
                                    </h:commandLink>
                                </f:facet>
                                <h:outputText value="#{description.role}" />
                            </h:column>

                            <h:column rendered="#{submissionStatus.sortType eq 'role' and submissionStatus.sortAscending}">
                                <f:facet name="header">
                                    <h:commandLink title="#{evaluationMessages.t_sortRole}" action="submissionStatus">
                                        <h:outputText value="#{evaluationMessages.role}" />
                                        <f:param name="sortAscending" value="false" />
                                        <h:graphicImage alt="#{evaluationMessages.alt_sortRoleDescending}"
                                            rendered="#{submissionStatus.sortAscending}"
                                            url="/images/sortascending.gif" />
                                        <f:actionListener
                                            type="org.sakaiproject.tool.assessment.ui.listener.evaluation.SubmissionStatusListener" />
                                    </h:commandLink>
                                </f:facet>
                                <h:outputText value="#{description.role}" />
                            </h:column>

                            <h:column rendered="#{submissionStatus.sortType eq 'role' and !submissionStatus.sortAscending}">
                                <f:facet name="header">
                                    <h:commandLink title="#{evaluationMessages.t_sortRole}" action="submissionStatus">
                                        <h:outputText value="#{evaluationMessages.role}" />
                                        <f:param name="sortAscending" value="true" />
                                        <h:graphicImage alt="#{evaluationMessages.alt_sortRoleAscending}"
                                            rendered="#{!submissionStatus.sortAscending}"
                                            url="/images/sortdescending.gif" />
                                        <f:actionListener
                                            type="org.sakaiproject.tool.assessment.ui.listener.evaluation.SubmissionStatusListener" />
                                    </h:commandLink>
                                </f:facet>
                                <h:outputText value="#{description.role}" />
                            </h:column>

                            <h:column rendered="#{submissionStatus.sortType ne 'submittedDate'}">
                                <f:facet name="header">
                                    <h:commandLink title="#{evaluationMessages.t_sortSubmittedDate}" id="submittedDate"
                                        action="submissionStatus">
                                        <h:outputText value="#{evaluationMessages.date}" />
                                        <f:actionListener
                                            type="org.sakaiproject.tool.assessment.ui.listener.evaluation.SubmissionStatusListener" />
                                        <f:param name="sortBy" value="submittedDate" />
                                    </h:commandLink>
                                </f:facet>
                                <h:outputText
                                    rendered="#{description.submittedDate != null and description.submittedDate ne ''}"
                                    value="#{description.submittedDate}">
                                    <f:convertDateTime dateStyle="medium" timeStyle="short"
                                        timeZone="#{author.userTimeZone}" />
                                </h:outputText>
                                <h:outputText
                                    rendered="#{description.submittedDate == null or description.submittedDate eq ''}"
                                    value="#{evaluationMessages.no_submission}" />
                            </h:column>

                            <h:column
                                rendered="#{submissionStatus.sortType eq 'submittedDate' and submissionStatus.sortAscending}">
                                <f:facet name="header">
                                    <h:commandLink title="#{evaluationMessages.t_sortSubmittedDate}"
                                        action="submissionStatus">
                                        <h:outputText value="#{evaluationMessages.date}" />
                                        <f:param name="sortAscending" value="false" />
                                        <h:graphicImage
                                            alt="#{evaluationMessages.alt_sortSubmittedDateDescending}"
                                            rendered="#{submissionStatus.sortAscending}"
                                            url="/images/sortascending.gif" />
                                        <f:actionListener
                                            type="org.sakaiproject.tool.assessment.ui.listener.evaluation.SubmissionStatusListener" />
                                    </h:commandLink>
                                </f:facet>
                                <h:outputText
                                    rendered="#{description.submittedDate != null and description.submittedDate ne ''}"
                                    value="#{description.submittedDate}">
                                    <f:convertDateTime dateStyle="medium" timeStyle="short"
                                        timeZone="#{author.userTimeZone}" />
                                </h:outputText>
                                <h:outputText
                                    rendered="#{description.submittedDate == null or description.submittedDate eq ''}"
                                    value="#{evaluationMessages.no_submission}" />
                            </h:column>

                            <h:column
                                rendered="#{submissionStatus.sortType eq 'submittedDate' and !submissionStatus.sortAscending}">
                                <f:facet name="header">
                                    <h:commandLink title="#{evaluationMessages.t_sortSubmittedDate}"
                                        action="submissionStatus">
                                        <h:outputText value="#{evaluationMessages.date}" />
                                        <f:param name="sortAscending" value="true" />
                                        <h:graphicImage alt="#{evaluationMessages.alt_sortSubmittedDateAscending}"
                                            rendered="#{!submissionStatus.sortAscending}"
                                            url="/images/sortdescending.gif" />
                                        <f:actionListener
                                            type="org.sakaiproject.tool.assessment.ui.listener.evaluation.SubmissionStatusListener" />
                                    </h:commandLink>
                                </f:facet>
                                <h:outputText
                                    rendered="#{description.submittedDate != null and description.submittedDate ne ''}"
                                    value="#{description.submittedDate}">
                                    <f:convertDateTime dateStyle="medium" timeStyle="short"
                                        timeZone="#{author.userTimeZone}" />
                                </h:outputText>
                                <h:outputText
                                    rendered="#{description.submittedDate == null or description.submittedDate eq ''}"
                                    value="#{evaluationMessages.no_submission}" />
                            </h:column>

                        </h:dataTable>
                    </div>
                </h:form>
            </div>
        </h:body>
    </f:view>

</ui:composition>
